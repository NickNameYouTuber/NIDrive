import{k as U,l as E,s as y,P as C,g as h,m as G,_ as W,n as j,j as e,o as K,p as J,T as n,r as u,i as v,f as Q,B as m,h as X,D as Y,q as ne,t as le,v as ie,w as ce,x as de,I as O,c as ue,b as ve,y as fe}from"./index-d88770ce.js";import{G as $,d as pe}from"./CloudUpload-8d15fcd2.js";import{T as k,f as B,a as xe,L as he}from"./folderService-66438607.js";import{B as M}from"./Button-a55e1eb0.js";function me(a){return U("MuiCard",a)}E("MuiCard",["root"]);const je=["className","raised"],ge=a=>{const{classes:r}=a;return J({root:["root"]},me,r)},_e=y(C,{name:"MuiCard",slot:"Root",overridesResolver:(a,r)=>r.root})(()=>({overflow:"hidden"})),ye=h.forwardRef(function(r,d){const l=G({props:r,name:"MuiCard"}),{className:i,raised:s=!1}=l,f=W(l,je),o=j({},l,{raised:s}),t=ge(o);return e.jsx(_e,j({className:K(t.root,i),elevation:s?8:void 0,ref:d,ownerState:o},f))}),$e=ye;function Ce(a){return U("MuiCardHeader",a)}const He=E("MuiCardHeader",["root","avatar","action","content","title","subheader"]),T=He,be=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],Re=a=>{const{classes:r}=a;return J({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},Ce,r)},Se=y("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(a,r)=>j({[`& .${T.title}`]:r.title,[`& .${T.subheader}`]:r.subheader},r.root)})({display:"flex",alignItems:"center",padding:16}),Me=y("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(a,r)=>r.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Ie=y("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(a,r)=>r.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),we=y("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(a,r)=>r.content})({flex:"1 1 auto"}),De=h.forwardRef(function(r,d){const l=G({props:r,name:"MuiCardHeader"}),{action:i,avatar:s,className:f,component:o="div",disableTypography:t=!1,subheader:p,subheaderTypographyProps:b,title:A,titleTypographyProps:R}=l,S=W(l,be),c=j({},l,{component:o,disableTypography:t}),x=Re(c);let g=A;g!=null&&g.type!==n&&!t&&(g=e.jsx(n,j({variant:s?"body2":"h5",className:x.title,component:"span",display:"block"},R,{children:g})));let _=p;return _!=null&&_.type!==n&&!t&&(_=e.jsx(n,j({variant:s?"body2":"body1",className:x.subheader,color:"text.secondary",component:"span",display:"block"},b,{children:_}))),e.jsxs(Se,j({className:K(x.root,f),as:o,ref:d,ownerState:c},S,{children:[s&&e.jsx(Me,{className:x.avatar,ownerState:c,children:s}),e.jsxs(we,{className:x.content,ownerState:c,children:[g,_]}),i&&e.jsx(Ie,{className:x.action,ownerState:c,children:i})]}))}),Pe=De;var I={},Fe=v;Object.defineProperty(I,"__esModule",{value:!0});var w=I.default=void 0,ze=Fe(u()),Le=e;w=I.default=(0,ze.default)((0,Le.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var D={},Ve=v;Object.defineProperty(D,"__esModule",{value:!0});var H=D.default=void 0,Ne=Ve(u()),qe=e;H=D.default=(0,Ne.default)((0,qe.jsx)("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder");var P={},Ae=v;Object.defineProperty(P,"__esModule",{value:!0});var Z=P.default=void 0,Oe=Ae(u()),ke=e;Z=P.default=(0,Oe.default)((0,ke.jsx)("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5zm4-3H19v1h1.5V11H19v2h-1.5V7h3zM9 9.5h1v-1H9zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm10 5.5h1v-3h-1z"}),"PictureAsPdf");var F={},Be=v;Object.defineProperty(F,"__esModule",{value:!0});var ee=F.default=void 0,Te=Be(u()),Ue=e;ee=F.default=(0,Te.default)((0,Ue.jsx)("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image");var z={},Ee=v;Object.defineProperty(z,"__esModule",{value:!0});var te=z.default=void 0,Ge=Ee(u()),We=e;te=z.default=(0,Ge.default)((0,We.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description");var L={},Ke=v;Object.defineProperty(L,"__esModule",{value:!0});var re=L.default=void 0,Je=Ke(u()),Qe=e;re=L.default=(0,Je.default)((0,Qe.jsx)("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile");var V={},Xe=v;Object.defineProperty(V,"__esModule",{value:!0});var ae=V.default=void 0,Ye=Xe(u()),Ze=e;ae=V.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile");var N={},et=v;Object.defineProperty(N,"__esModule",{value:!0});var se=N.default=void 0,tt=et(u()),rt=e;se=N.default=(0,tt.default)((0,rt.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"OpenInNew");var q={},at=v;Object.defineProperty(q,"__esModule",{value:!0});var oe=q.default=void 0,st=at(u()),ot=e;oe=q.default=(0,st.default)((0,ot.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"GetApp");const nt=()=>{const[a,r]=h.useState([]),[d,l]=h.useState(!0),i=Q();h.useEffect(()=>{(async()=>{try{l(!0);const b=(await B.getRecentFiles()).map(c=>({...c,type:"file"})),R=(await xe.getRecentFolders()).map(c=>({...c,type:"folder"})),S=[...b,...R].sort((c,x)=>new Date(x.created_at).getTime()-new Date(c.created_at).getTime()).slice(0,5);r(S)}catch(p){console.error("Error fetching recent items:",p)}finally{l(!1)}})()},[]);const s=t=>{t.type==="file"?t.folder_id?i(`/storage/${t.folder_id}`):i("/storage"):i(`/storage/${t.id}`)},f=async t=>{try{await B.downloadFile(t)}catch(p){console.error("Error downloading file:",p)}},o=t=>t.startsWith("image/")?e.jsx(ee,{}):t==="application/pdf"?e.jsx(Z,{}):t.startsWith("video/")?e.jsx(re,{}):t.startsWith("audio/")?e.jsx(ae,{}):t==="application/msword"||t==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||t==="text/plain"?e.jsx(te,{}):e.jsx(w,{});return d?e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(X,{})}):e.jsxs($e,{variant:"outlined",children:[e.jsx(Pe,{title:"Recent Files & Folders"}),e.jsx(Y,{}),a.length>0?e.jsx(ne,{children:a.map(t=>e.jsxs(le,{button:!0,onClick:()=>s(t),sx:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[e.jsx(ie,{children:t.type==="file"?o(t.mime_type):e.jsx(H,{})}),e.jsx(ce,{primary:t.type==="file"?t.filename:t.name,secondary:new Date(t.created_at).toLocaleDateString()}),e.jsxs(de,{children:[t.type==="file"&&e.jsx(k,{title:"Download",children:e.jsx(O,{edge:"end","aria-label":"download",onClick:p=>{p.stopPropagation(),f(t.id)},children:e.jsx(oe,{})})}),e.jsx(k,{title:"Open location",children:e.jsx(O,{edge:"end","aria-label":"open",onClick:()=>s(t),children:e.jsx(se,{})})})]})]},`${t.type}-${t.id}`))}):e.jsx(m,{sx:{p:3,textAlign:"center"},children:e.jsx(n,{color:"textSecondary",children:"No recent activity"})})]})},ut=()=>{const{user:a}=ue(),[r,d]=h.useState(null),[l,i]=h.useState(!0),s=Q();h.useEffect(()=>{(async()=>{try{i(!0);const t=await fe.getUserStats();d(t)}catch(t){console.error("Failed to fetch user stats:",t)}finally{i(!1)}})()},[]);const f=o=>o<1?`${Math.round(o*1024)} KB`:o<1024?`${Math.round(o*10)/10} MB`:`${Math.round(o/102.4)/10} GB`;return l?e.jsx(m,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:e.jsx(X,{})}):e.jsxs(m,{sx:{p:3},children:[e.jsxs(n,{variant:"h4",gutterBottom:!0,children:["Добро пожаловать, ",(a==null?void 0:a.username)||"User","!"]}),e.jsx(n,{variant:"body1",color:"textSecondary",gutterBottom:!0,children:"Вот обзор вашего хранилища NIDrive."}),e.jsxs($,{container:!0,spacing:3,sx:{mt:3},children:[e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(C,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center"},elevation:3,children:[e.jsx(w,{sx:{fontSize:48,color:"primary.main",mb:1}}),e.jsx(n,{variant:"h6",children:"Файлов"}),e.jsx(n,{variant:"h4",children:(r==null?void 0:r.total_files)||0})]})}),e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(C,{sx:{p:3,display:"flex",flexDirection:"column",alignItems:"center"},elevation:3,children:[e.jsx(H,{sx:{fontSize:48,color:"warning.main",mb:1}}),e.jsx(n,{variant:"h6",children:"Папок"}),e.jsx(n,{variant:"h4",children:(r==null?void 0:r.total_folders)||0})]})}),e.jsx($,{item:!0,xs:12,sm:6,md:6,children:e.jsxs(C,{sx:{p:3,display:"flex",flexDirection:"column"},elevation:3,children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ve,{sx:{fontSize:48,color:"success.main",mr:2}}),e.jsxs(m,{children:[e.jsx(n,{variant:"h6",children:"Использовано пространства"}),e.jsxs(n,{variant:"body2",color:"textSecondary",children:[f((r==null?void 0:r.used_space)||0)," из ",f((r==null?void 0:r.quota)||0)]})]})]}),e.jsx(he,{variant:"determinate",value:(r==null?void 0:r.usage_percent)||0,sx:{height:8,borderRadius:4}})]})})]}),e.jsxs(m,{sx:{mt:4,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(M,{variant:"contained",startIcon:e.jsx(pe,{}),onClick:()=>s("/upload"),children:"Загрузить файл"}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>s("/create-folder"),children:"Создать папку"}),e.jsx(M,{variant:"outlined",onClick:()=>s("/storage"),children:"Перейти к хранилищу"})]}),e.jsx(Y,{sx:{my:4}}),e.jsx(nt,{})]})};export{ut as default};
